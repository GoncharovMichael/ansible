# Ansible and fail2ban
Изменения:
1. Создал новую ветку. Реквест после ревью
2. Распределил инветори по разным файлам: group_vars, host_vars. Поэксперементировал со всем этим
3. Вывел переменные для правил fail2ban в корневой плейбук, для удобного регулирования
4. Сделал become: yes - только в требующих этого тасках
5. Удалил все ненужные папки
6. Отредавктировал таски: сократил алкгоритм для Redhat, объединил в один таск обновление и загрузку для Debian, исправил общий алгоритм.(изучил notify)
7. Переписал роль для обеспечения пункта 3.
8. Заменил модуль shell на command
9. Разбил файл с тасками на три штуки. Вынес алгоритм для redhat и debian в отдельные yml-файлы
10. Исправил путь в переменной, чтобы папка с проектом могла находиться где угодно и не рушила алгоритм
11. Зашифровал отдельные компромитирующие переменные







Если не будет запускаться, то подправь переменную "path_file". Она находится в 
```bash
vim roles/fail2ban_master/defaults/main.yml 
```
Коппируемый файл находится по адресу: 
```bash
cat roles/fail2ban_master/files/jail.local
```
## Ход работы: 
 - Сценарий работает с двумя операционными системами: debian and redhat.
 - Обновляет пакетные менеджеры: apt и yum.
 - Устанавливает fail2ban.
 - Конфиги с данными для входа в систему зашифрованы. А также зашифрован файл с правилами защиты для fail2ban.
    - Кол-во попыток - 3
    - С каждым разом время бана удваивается:
   
| Количество банов | Время блокировки |
|------------------|------------------|
| 1                | 1 минута         |
| 2                | 2 минуты         |
| 3                | 4 минуты         |

После, ip добавляется в "recidiv-list" и блокируется навсегда "-1".

Что, кстати, не очень экономно, но условие задачи - есть условие задачи.
  - Выводит на экран состояние сервера fail2ban.
    
## Запускать playbook с помощью команды: 
```bash
ansible-playbook playbook.yml --ask-vault-pass
```
или 
```bash
ansible-playbook playbook.yml --vault-password-file [path_to_passwfile]
```
  p.s пароль передам через лс.
  
  p.s.s знаю, что было долго, но тем не менее жду следующего задания


